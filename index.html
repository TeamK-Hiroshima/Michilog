<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0" />
    <meta charset="utf-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <label>検索ワード：</label>
    <input type="text" name="name" size="30" />
    <label> 種別：</label>
    <select name="evaluation">
      <option value="good">いいね</option>
      <option value="bad">悪いね</option>
    </select>
    <div id="map"></div>
    <script>
      // 参考サイト：ベース https://blog.codecamp.jp/googlemaps-api
      // 参考サイト：公式 https://developers.google.com/maps/documentation/javascript/adding-a-google-map
      // 参考サイト：複数マーカー（動かないけど、説明が丁寧） https://www.tam-tam.co.jp/tipsnote/javascript/post7755.html
      // 参考サイト：複数マーカー https://leben.mobi/blog/google_maps_api_macker/javascript/

      var map;
      var marker = [];
      var infoWindow = [];
      var markerDataGood = [
        // マーカーを立てる場所名・緯度・経度
        {
          name: '<a href="http://google.com">きれいな道</a>',
          lat: 34.365181,
          lng: 132.469987
        },
        {
          name: "車が少ない",
          lat: 34.3665,
          lng: 132.469984
        },
        {
          name: "ストレスがない",
          lat: 34.365495,
          lng: 132.469861
        },
        {
          name: "見通しが良い",
          lat: 34.365783,
          lng: 132.470633
        }
      ];
      var markerDataBad = [
        // マーカーを立てる場所名・緯度・経度
        {
          name: "道が狭い",
          lat: 34.365522,
          lng: 132.471261
        },
        {
          name: "怖い",
          lat: 34.366731,
          lng: 132.470107
        },
        {
          name: "道がガタガタ",
          lat: 34.365345,
          lng: 132.470381
        },
        {
          name: "人通りが多い",
          lat: 34.365863,
          lng: 132.469463
        },
        {
          name: "道が狭い",
          lat: 34.364991,
          lng: 132.470085
        }
      ];

      function initMap() {
        // 地図の作成
        var defaultPosition = new google.maps.LatLng({
          lat: 34.366,
          lng: 132.471
        }); // とりあえず決め打ち・・・
        map = new google.maps.Map(document.getElementById("map"), {
          // #sampleに地図を埋め込む
          center: defaultPosition, // 地図の中心を指定
          zoom: 18 // 地図のズームを指定
        });

        dispMakers($("[name=evaluation]").val());
      }

      // マーカーにクリックイベントを追加
      function markerEvent(i) {
        marker[i].addListener("click", function() {
          // マーカーをクリックしたとき
          infoWindow[i].open(map, marker[i]); // 吹き出しの表示
        });
      }

      function dispMakers(eval) {
        // マーカーを初期化（既にあるやつを削除）
        for (var i = 0; i < marker.length; i++) {
          marker[i].setMap(null);
        }
        // マーカー毎の処理
        var markerData = getMarkerData(eval);
        for (var i = 0; i < markerData.length; i++) {
          markerLatLng = new google.maps.LatLng({
            lat: markerData[i]["lat"],
            lng: markerData[i]["lng"]
          }); // 緯度経度のデータ作成
          marker[i] = new google.maps.Marker({
            // マーカーの追加
            position: markerLatLng, // マーカーを立てる位置を指定
            icon: getMarkerIcon(eval),
            animation: google.maps.Animation.DROP
          });

          infoWindow[i] = new google.maps.InfoWindow({
            // 吹き出しの追加
            content: '<div class="map">' + markerData[i]["name"] + "</div>" // 吹き出しに表示する内容
          });

          markerEvent(i); // マーカーにクリックイベントを追加

          // マーカーを設置
          marker[i].setMap(map);
        }
      }

      function getMarkerData(eval) {
        if (eval == `good`) {
          return markerDataGood;
        } else {
          return markerDataBad;
        }
      }

      function getMarkerIcon(eval) {
        if (eval == `good`) {
          //return "https://maps.google.com/mapfiles/ms/icons/red-dot.png";
          // return {
          //   path: "M -8,-8 8,8 M 8,-8 -8,8", //座標（×）
          //   strokeColor: "#000000", //線の色
          //   strokeWeight: 4.0, //線の太さ
          //   scaledSize: new google.maps.Size(40, 40) //サイズ
          // };
          return {
            url:
              //"https://chart.apis.google.com/chart?chst=d_map_spin&chld=0.8|0|ff4500|10|_|good"
              "https://chart.apis.google.com/chart?chst=d_map_pin_letter_withshadow&chld=%E2%80%A2|ff6347"
          };
        } else {
          return {
            url:
              //"https://chart.apis.google.com/chart?chst=d_map_spin&chld=0.8|0|0000ff|10|_|bad"
              "https://chart.apis.google.com/chart?chst=d_map_pin_letter_withshadow&chld=%E2%80%A2|4169e1"
          };
        }
      }

      $("[name=evaluation]").change(function() {
        var val = $("[name=evaluation]").val();

        dispMakers(val);
      });
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=XXXXX&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
